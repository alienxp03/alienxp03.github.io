<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Upgrading Fave to Rails 5.0 | alienxp03</title><meta name=keywords content="rails,fave"><meta name=description content="Upgrading Fave to Rails 5.0"><meta name=author content="Me"><link rel=canonical href=https://azuanz.com/posts/upgrading-fave-to-rails-5.0/><meta name=google-site-verification content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.8b523f1730c922e314350296d83fd666efa16519ca136320a93df674d00b6325.css integrity="sha256-i1I/FzDJIuMUNQKW2D/WZu+hZRnKE2MgqT32dNALYyU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://azuanz.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://azuanz.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://azuanz.com/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://azuanz.com/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://azuanz.com/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Upgrading Fave to Rails 5.0"><meta property="og:description" content="Upgrading Fave to Rails 5.0"><meta property="og:type" content="article"><meta property="og:url" content="https://azuanz.com/posts/upgrading-fave-to-rails-5.0/"><meta property="og:image" content="https://azuanz.com/%3Cimage%20path/url%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-06T11:30:03+00:00"><meta property="article:modified_time" content="2022-06-06T11:30:03+00:00"><meta property="og:site_name" content="alienxp03"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://azuanz.com/%3Cimage%20path/url%3E"><meta name=twitter:title content="Upgrading Fave to Rails 5.0"><meta name=twitter:description content="Upgrading Fave to Rails 5.0"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://azuanz.com/posts/"},{"@type":"ListItem","position":3,"name":"Upgrading Fave to Rails 5.0","item":"https://azuanz.com/posts/upgrading-fave-to-rails-5.0/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Upgrading Fave to Rails 5.0","name":"Upgrading Fave to Rails 5.0","description":"Upgrading Fave to Rails 5.0","keywords":["rails","fave"],"articleBody":"In Fave, we are still largely powered by our majestic monolith Ruby on Rails app. On 3rd November 2021, we finally reached a big milestone and upgraded our app from 4.2 to 5.0!\nInitially, we wanted to upgrade earlier. However priority changed. Truth is, it took us around 3 years and 3 months before we finally finished the upgrade. I’m hoping to share on our Rails upgrade journey and why it took us so long to reach here.\n1. Dual boot When we first started the project, our naive solution was to create a pull request and slowly update the codebase to make it compatible with both version of Rails. However, it started to get bigger and getting harder to do code review.\nReading on how Github does it definitely helps us a lot in this case. Moving forward, we decided that dual boot is how we can incrementally update our codebase. Using next_rails is not necessary but it does make it easier for us.\nif Fave.next? # code for Rails 5.0 else # code for Rails 4.2 end 2. Gems Gems are definitely one of my favourite thing about Rails. There’s a gem for almost everything. However, left unchecked, it can cause different issues.\nIn our case, having too many gems make it hard for us to upgrade our Rails app. Some gems are no longer maintained, some have too many dependencies.\nIn our journey to upgrade our app, we decided that sometimes it’s easier to remove a gem than upgrading it. Less is more. When we absolutely need to upgrade a particular gem, do it one gem at a time so it’s easier to keep track of the changes.\n3. Forks Sometimes, there are cases where we decided to fork certain gems and customize it to our own workflow. Most of the time we realized that we didn’t keep our fork up to date with the upstream. Outdated forks are risky and it’s hard for us to move upgrade our codebase.\nThe solutions here are not easy. If we do need to fork a repo, our best option here is to always keep it up to date with the upstream. Monkey patch might not be a popular option, but if we can manage it right, it’s a lot easier than maintaing a fork. Each solution has it’s own pros and cons.\n4. Negotiating priorities Engineers love to talk about the technicalities. In fact, we love it too much that sometimes we forgot not everyone understand the technical jargon that we are using.\nWhen we couldn’t explain in simple words on why we need to upgrade Ruby on Rails, our team leads might not understand the importance of it. Instead of saying we need to upgrade Rails because we can use ActionCable, we can try to reword it to Rails 5 allows us to use real-time update feature.\nWhen we can’t explain it in simple terms, it’s hard for others to truly understand what’s our goal and objectives. And it’s hard to prioritize something that not everyone understand.\nThe truth is, we’re not working alone. If we can’t explain it in simple terms, there are others in our team that could help. In the end, it’s a team effort. Communication is the key here.\n5. Help others to help you For our Rails upgrade, we created a Slack channel to have a discussion and gather people for the project. I remember being so enthusiastic about the project and I was so sure that people would like to be involved in it. Few weeks after we started the project, we barely getting any help. Took me a while, but I decided to try with a different approach and posted this on the Slack channel.\nWhat I did was create a specific instruction on what kind of help that we need, and how exactly can others help. In less than few weeks, we managed to fix all of our test and run both Rails 4 and 5 on our CI. Turns out, people were excited with the project. They’re just not sure on how can they contribute.\n6. Have a plan When we first started, we have a rough idea on what we’re trying to do. However it wasn’t final. Now that we’ve done it, all that’s left is just to document our steps and keep improving it. This is how it looks like for us.\n1. Setup dual boot for current and next Rails. 2. Run both Rails version in CI i. Current Rails version must always be green. ii. Next Rails version is allowed to fail until we fix all the errors. 3. All test in CI must pass 4. Run full regression test with our QA team. i. Combination of both automated and manual testing. 5. Switch all staging servers to use new Rails version. 6. Canary release on production. 7. Once everything is stable, remove old Rails version from the codebase. In the end, we are happy with the upgrade. Just like any other project, not everything is about coding and we certainly learned our lesson here. It was a long journey for us but it was worth it.\nResources https://github.blog/2018-09-28-upgrading-github-from-rails-3-2-to-5-2/ https://github.com/fastruby/next_rails https://www.fastruby.io/blog/rails/upgrades/upgrade-rails-from-4-2-to-5-0.html ","wordCount":"866","inLanguage":"en","image":"https://azuanz.com/%3Cimage%20path/url%3E","datePublished":"2022-06-06T11:30:03Z","dateModified":"2022-06-06T11:30:03Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://azuanz.com/posts/upgrading-fave-to-rails-5.0/"},"publisher":{"@type":"Organization","name":"alienxp03","logo":{"@type":"ImageObject","url":"https://azuanz.com/%3Clink%20/%20abs%20url%3E"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://azuanz.com accesskey=h title="alienxp03 (Alt + H)">alienxp03</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://azuanz.com/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://azuanz.com>Home</a>&nbsp;»&nbsp;<a href=https://azuanz.com/posts/>Posts</a></div><h1 class=post-title>Upgrading Fave to Rails 5.0</h1><div class=post-description>Upgrading Fave to Rails 5.0</div><div class=post-meta><span title='2022-06-06 11:30:03 +0000 UTC'>June 6, 2022</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/alienxp03/content/posts/upgrading-fave-to-rails-5.0.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#1-dual-boot aria-label="1. Dual boot">1. Dual boot</a></li><li><a href=#2-gems aria-label="2. Gems">2. Gems</a></li><li><a href=#3-forks aria-label="3. Forks">3. Forks</a></li><li><a href=#4-negotiating-priorities aria-label="4. Negotiating priorities">4. Negotiating priorities</a></li><li><a href=#5-help-others-to-help-you aria-label="5. Help others to help you">5. Help others to help you</a></li><li><a href=#6-have-a-plan aria-label="6. Have a plan">6. Have a plan</a><ul><li><a href=#resources aria-label=Resources>Resources</a></li></ul></li></ul></div></details></div><div class=post-content><p>In <a href=https://myfave.com>Fave</a>, we are still largely powered by our majestic monolith Ruby on Rails app. On 3rd November 2021, we finally reached
a big milestone and upgraded our app from 4.2 to 5.0!</p><p><img loading=lazy src=/rails-5.0-alienxp03.jpg alt=Image></p><p>Initially, we wanted to upgrade earlier. However priority changed. Truth is, it took us around 3 years and 3 months before we finally finished the upgrade. I&rsquo;m hoping to share on our Rails upgrade journey and why it took us so long to reach here.</p><h2 id=1-dual-boot>1. Dual boot<a hidden class=anchor aria-hidden=true href=#1-dual-boot>#</a></h2><p>When we first started the project, our naive solution was to create a pull request and slowly update the codebase to make it compatible with both version of Rails. However, it started to get bigger and getting harder to do code review.</p><p>Reading on how <a href=https://github.blog/2018-09-28-upgrading-github-from-rails-3-2-to-5-2/>Github does it</a> definitely helps us a lot in this case. Moving forward, we decided that dual boot is how we can incrementally update our codebase. Using <a href=https://github.com/fastruby/next_rails>next_rails</a> is not necessary but it does make it easier for us.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#66d9ef>Fave</span><span style=color:#f92672>.</span>next?
</span></span><span style=display:flex><span>  <span style=color:#75715e># code for Rails 5.0</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># code for Rails 4.2</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><h2 id=2-gems>2. Gems<a hidden class=anchor aria-hidden=true href=#2-gems>#</a></h2><p>Gems are definitely one of my favourite thing about Rails. There&rsquo;s a gem for almost everything. However, left unchecked, it can cause different issues.</p><p>In our case, having too many gems make it hard for us to upgrade our Rails app. Some gems are no longer maintained, some have too many dependencies.</p><p>In our journey to upgrade our app, we decided that sometimes it&rsquo;s easier to remove a gem than upgrading it. Less is more. When we absolutely need to upgrade a particular gem, do it one gem at a time so it&rsquo;s easier to keep track of the changes.</p><h2 id=3-forks>3. Forks<a hidden class=anchor aria-hidden=true href=#3-forks>#</a></h2><p>Sometimes, there are cases where we decided to fork certain gems and customize it to our own workflow. Most of the time we realized that we didn&rsquo;t keep our fork up to date with the upstream. Outdated forks are risky and it&rsquo;s hard for us to move upgrade our codebase.</p><p>The solutions here are not easy. If we do need to fork a repo, our best option here is to always keep it up to date with the upstream. Monkey patch might not be a popular option, but if we can manage it right, it&rsquo;s a lot easier than maintaing a fork. Each solution has it&rsquo;s own pros and cons.</p><h2 id=4-negotiating-priorities>4. Negotiating priorities<a hidden class=anchor aria-hidden=true href=#4-negotiating-priorities>#</a></h2><p>Engineers love to talk about the technicalities. In fact, we love it too much that sometimes we forgot not everyone understand the technical jargon that we are using.</p><p>When we couldn&rsquo;t explain in simple words on why we need to upgrade Ruby on Rails, our team leads might not understand
the importance of it. Instead of saying <code>we need to upgrade Rails because we can use ActionCable</code>, we can try to reword it to <code>Rails 5 allows us to use real-time update feature</code>.</p><p>When we can&rsquo;t explain it in simple terms, it&rsquo;s hard for others to truly understand what&rsquo;s our goal and objectives. And it&rsquo;s hard to prioritize something that not everyone understand.</p><p>The truth is, we&rsquo;re not working alone. If we can&rsquo;t explain it in simple terms, there are others in our team that could help. In the end, it&rsquo;s a team effort. Communication is the key here.</p><h2 id=5-help-others-to-help-you>5. Help others to help you<a hidden class=anchor aria-hidden=true href=#5-help-others-to-help-you>#</a></h2><p>For our Rails upgrade, we created a Slack channel to have a discussion and gather people for the project. I remember being so enthusiastic
about the project and I was so sure that people would like to be involved in it. Few weeks after we started the project, we barely getting any help. Took me a while, but I decided to try with a different approach and posted this on the Slack channel.</p><p><img loading=lazy src=/rails-upgrade/slack-rails-upgrade.jpg alt=Image></p><p>What I did was create a specific instruction on what kind of help that we need, and how exactly can others help. In less than few weeks, we managed to fix all of our test and run both Rails 4 and 5 on our CI. Turns out, people were excited with the project. They&rsquo;re just not sure on how can they contribute.</p><h2 id=6-have-a-plan>6. Have a plan<a hidden class=anchor aria-hidden=true href=#6-have-a-plan>#</a></h2><p>When we first started, we have a rough idea on what we&rsquo;re trying to do. However it wasn&rsquo;t final. Now that we&rsquo;ve done it, all that&rsquo;s left is just to document our steps and keep improving it. This is how it looks like for us.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#ae81ff>1</span>. Setup dual boot for current and next Rails.
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>. Run both Rails version in CI
</span></span><span style=display:flex><span>  i. Current Rails version must always be green.
</span></span><span style=display:flex><span>  ii. Next Rails version is allowed to fail until we fix all the errors.
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span>. All test in CI must pass
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span>. Run full regression test with our QA team.
</span></span><span style=display:flex><span>  i. Combination of both automated and manual testing.
</span></span><span style=display:flex><span><span style=color:#ae81ff>5</span>. Switch all staging servers to use new Rails version.
</span></span><span style=display:flex><span><span style=color:#ae81ff>6</span>. Canary release on production.
</span></span><span style=display:flex><span><span style=color:#ae81ff>7</span>. Once everything is stable, remove old Rails version from the codebase.
</span></span></code></pre></div><hr><p>In the end, we are happy with the upgrade. Just like any other project, not everything is about coding and we certainly learned our lesson here. It was a long journey for us but it was worth it.</p><hr><h3 id=resources>Resources<a hidden class=anchor aria-hidden=true href=#resources>#</a></h3><ul><li><a href=https://github.blog/2018-09-28-upgrading-github-from-rails-3-2-to-5-2/>https://github.blog/2018-09-28-upgrading-github-from-rails-3-2-to-5-2/</a></li><li><a href=https://github.com/fastruby/next_rails>https://github.com/fastruby/next_rails</a></li><li><a href=https://www.fastruby.io/blog/rails/upgrades/upgrade-rails-from-4-2-to-5-0.html>https://www.fastruby.io/blog/rails/upgrades/upgrade-rails-from-4-2-to-5-0.html</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://azuanz.com/tags/rails/>rails</a></li><li><a href=https://azuanz.com/tags/fave/>fave</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://azuanz.com>alienxp03</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>